{"version":3,"file":"_server.ts-Ds9yCWtZ.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/search/_server.ts.js"],"sourcesContent":["import { json, error } from \"@sveltejs/kit\";\nimport { sql } from \"kysely\";\nimport { d as db } from \"../../../../chunks/db.js\";\nconst searchableColumns = [\n  \"bu_estate\",\n  \"department\",\n  \"location\",\n  \"node\",\n  \"asset_type\",\n  \"manufacturer\",\n  \"model\",\n  \"wbd_tag\",\n  \"serial_license\"\n];\nconst GET = async ({ url }) => {\n  const searchTerm = url.searchParams.get(\"q\") || \"\";\n  const filterParams = url.searchParams.getAll(\"filter\");\n  try {\n    let query = db.selectFrom(\"asset_inventory\").selectAll();\n    if (searchTerm) {\n      query = query.where(\n        sql`MATCH(${sql.raw(searchableColumns.join(\", \"))}) AGAINST (${`*${searchTerm}*`} IN BOOLEAN MODE)`\n      );\n    }\n    const groupedFilters = {};\n    for (const filter of filterParams) {\n      const [column, value] = filter.split(\":\");\n      if (column && value) {\n        if (!groupedFilters[column]) groupedFilters[column] = [];\n        groupedFilters[column].push(value);\n      }\n    }\n    for (const [column, values] of Object.entries(groupedFilters)) {\n      query = query.where(column, \"in\", values);\n    }\n    const assets = await query.orderBy(\"id\").execute();\n    return json({ assets });\n  } catch (err) {\n    console.error(\"Database query failed:\", err);\n    throw error(500, \"Database error\");\n  }\n};\nexport {\n  GET\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAGA,MAAM,iBAAiB,GAAG;AAC1B,EAAE,WAAW;AACb,EAAE,YAAY;AACd,EAAE,UAAU;AACZ,EAAE,MAAM;AACR,EAAE,YAAY;AACd,EAAE,cAAc;AAChB,EAAE,OAAO;AACT,EAAE,SAAS;AACX,EAAE;AACF,CAAC;AACI,MAAC,GAAG,GAAG,OAAO,EAAE,GAAG,EAAE,KAAK;AAC/B,EAAE,MAAM,UAAU,GAAG,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,GAAG,CAAC,IAAI,EAAE;AACpD,EAAE,MAAM,YAAY,GAAG,GAAG,CAAC,YAAY,CAAC,MAAM,CAAC,QAAQ,CAAC;AACxD,EAAE,IAAI;AACN,IAAI,IAAI,KAAK,GAAG,EAAE,CAAC,UAAU,CAAC,iBAAiB,CAAC,CAAC,SAAS,EAAE;AAC5D,IAAI,IAAI,UAAU,EAAE;AACpB,MAAM,KAAK,GAAG,KAAK,CAAC,KAAK;AACzB,QAAQ,GAAG,CAAC,MAAM,EAAE,GAAG,CAAC,GAAG,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,WAAW,EAAE,CAAC,CAAC,EAAE,UAAU,CAAC,CAAC,CAAC,CAAC,iBAAiB;AAC1G,OAAO;AACP,IAAI;AACJ,IAAI,MAAM,cAAc,GAAG,EAAE;AAC7B,IAAI,KAAK,MAAM,MAAM,IAAI,YAAY,EAAE;AACvC,MAAM,MAAM,CAAC,MAAM,EAAE,KAAK,CAAC,GAAG,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC;AAC/C,MAAM,IAAI,MAAM,IAAI,KAAK,EAAE;AAC3B,QAAQ,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,EAAE,cAAc,CAAC,MAAM,CAAC,GAAG,EAAE;AAChE,QAAQ,cAAc,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC;AAC1C,MAAM;AACN,IAAI;AACJ,IAAI,KAAK,MAAM,CAAC,MAAM,EAAE,MAAM,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,cAAc,CAAC,EAAE;AACnE,MAAM,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC,MAAM,EAAE,IAAI,EAAE,MAAM,CAAC;AAC/C,IAAI;AACJ,IAAI,MAAM,MAAM,GAAG,MAAM,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,OAAO,EAAE;AACtD,IAAI,OAAO,IAAI,CAAC,EAAE,MAAM,EAAE,CAAC;AAC3B,EAAE,CAAC,CAAC,OAAO,GAAG,EAAE;AAChB,IAAI,OAAO,CAAC,KAAK,CAAC,wBAAwB,EAAE,GAAG,CAAC;AAChD,IAAI,MAAM,KAAK,CAAC,GAAG,EAAE,gBAAgB,CAAC;AACtC,EAAE;AACF;;;;"}